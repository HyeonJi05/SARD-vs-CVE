# 📁 CVE-2017-15108

**🔗 [커밋 링크](https://cgit.freedesktop.org/spice/linux/vd_agent/commit/?id=8ba174816d245757e743e636df357910e1d5eb61)** | **🔗 [CVE 링크](https://nvd.nist.gov/vuln/detail/CVE-2017-15108)**

| 총 슬라이스 수* |  정탐 | 미탐 |
| --------  | -- | -- |
| 15개       | 0개 | 15개 |

\* cve 설명에 나온 취약한 함수(Caller)에 대한 슬라이스만 고려

## 🔍 취약점 설명
> spice-vdagent의 save directory 과정 중 vdagent_file_xfers_data()에서 발생한 OS Command Injection 취약점입니다.

※ SPICE( Simple Protocol for Independent Computing Environments) 환경에서 사용하는 게스트 에이전트 프로그램입니다. 주로 가상 머신(VM) 내부에 설치되며, SPICE 프로토콜을 사용하는 가상화 솔루션(예: QEMU/KVM)의 게스트와 호스트 간 통신을 향상시키는 역할을 합니다.

* **취약 조건**: 입력값을 검증하지 않고
* **취약 동작**: 위험한 `system()` 함수 사용


### ❗️ 취약 코드

**문제점**:
사용자 입력이 적절히 검증되지 않은 채로 `system()` 함수의 인자로 사용되어 **명령어 인젝션**이 발생할 수 있음.

#### Sink: `before_file-xfers.c:341`
```c
char buf[PATH_MAX];
snprintf(buf, PATH_MAX, "xdg-open '%s'&", xfers->save_dir);
status = system(buf); /* POTENTIAL FLAW */ 
```


### ✅ 개선 코드

**패치 위치**: `after_file-xfers.c:340`

```c
GError *error = NULL;
gchar *argv[] = { "xdg-open", xfers->save_dir, NULL };
if (!g_spawn_async(NULL, argv, NULL,
                        G_SPAWN_SEARCH_PATH,
                        NULL, NULL, NULL, &error)) {
    syslog(LOG_WARNING,
            "file-xfer: failed to open save directory: %s",
            error->message);
    g_error_free(error);
}
```

**개선 방법**:

* argv[] 배열을 통해 명령과 인자를 구분해서 처리함 → 쉘 해석 우회 불가능
* 또한, `system()` 함수 대신 안전한 g_spawn_async()로 대체

## SARD와 탐지 결과 비교
KSignSlicer의 AI 모델은 SARD CWE78에 대해 슬라이스에 strcat()가 있을 때 취약으로 탐지해왔습니다. 그런데 이 취약점은 system()함수를 활용하여 정상으로 탐지된 것으로 보입니다.